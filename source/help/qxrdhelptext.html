<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>QXRD Reference</title>
  </head>

  <body>
    <h1>QXRD Reference</h1>
    <h2><a name=MainWindow>The Main Window</h2>
    <p>
      <img src="images/initial-screen.png">
    </p>

    <h2><a name=Acquire>The Acquire Dialog</h2>
    <table border=0 cellpadding=5 width="100%">
	<tr>
	  <td align="center">
            <img src="images/acquire-dialog.png">
	  </td>
	</tr>
	<tr>
	  <td align="center">
	    <p>
              The 'Acquire' Dialog
	    </p>
	  </td>
    </table>
    <p>
      The acquire dialog is where you enter parameters related to the
      basic acquisition operation.  The result of an individual
      acquisition operation consists of a sequence of image files,
      each containing the sum of a number of individual exposures.
      The 'Exposure Time' control lets you specify the individual
      exposure (or integration) time.  You can choose from a set of 8
      pre-set exposure times by clicking the up and down arrows, or
      choose an arbitrary exposure time by typing values directly into
      the text box.  The maximum 'supported' time for the Exposure
      Time is 5 seconds, but you may find that (depending on which
      model of detector you have) you can specify longer exposure
      times, perhaps as high as 8 seconds.
    </p>

    <p>
      The 'Camera Gain' control specifies the analog gain of the
      camera readout electronics, the highest gain setting is probably
      the one to choose here.  If you have strong signals and want to
      perform long exposures it may be advantageous to reduce the
      analog gain to avoid saturating pixels.
    </p>

    <p>
      If you change the exposure time or camera gain you should always
      measure a new 'dark' image.
    </p>

    <p>
      The 'Binning' control is intended to allow you to choose between
      various binning options for the images - it doesn't work yet,
      however.
    </p>

    <p>
      The 'Skipped at Start' control lets you specify a number of
      exposures to skip at the start of a readout sequence.  This is
      mainly needed because the operating mode of the detector is such
      that it is continually reading out all the time (as you should
      see from the updates to the 'Avg. Value' control).  When an
      acquisition operation is started the detector readout timing is
      not adjusted, the software just starts to accumulate the data
      that is being acquired in any case. The upshot of this is that
      the first exposure in a sequence will include a partial exposure
      from before the start of the acquisition. In the case where you
      are taking a sequence of images with the shutter open this may
      not be a problem and it should be okay to set a 'Skipped at
      Start' value of zero.  Alternatively, set 'Skipped at Start' to
      one and the acquisition will skip the frame that was being
      exposed when the acquire operation was started.  The program
      automatically sets 'Skipped at Start' to one when dark frames
      are measured.
    </p>
    
    <p>
      The 'Summed' control lets you specify the number of individual
      exposures to add together into each saved file.  If you choose a
      'Summed Exposures' value of 1, then the individual raw images
      are saved as 16 bit integer TIFF files - about 8MB each.  If you
      choose a larger value for the summed exposures the raw images
      will be saved as 32 bit integer TIFF files - about 16MB each.
      The choice of data types implies that you can sum as many as
      65535 exposures without losing information - this should be
      sufficient for all reasonable circumstances!
    </p>
    
    <p>
      The 'Skipped' control lets you specify a number of exposures to
      skip between each acquired file.  This is something like a
      'time-lapse' control for amovie camera.
    </p>

    <p>
      The 'Phases in Group' control lets you perform 'synchronized'
      acquisition operations.  If you enter a value greater than one
      then the acquisition operations are modified to acquire 'groups'
      of images - and during each group acquisition an external hardware
      signal may be used to drive an external ramp voltage.  More information
      is given in the <a href="#SyncAcq">'Synchronized Acquisition'</a> section below.
    </p>

    <p>
      The 'Pre Trigger' and 'Post Trigger' controls are used to
      specify the number of image files to save.  In most cases you
      won't want to use the 'Trigger' option so you should set the
      'Pre Trigger' control to zero.  In this case
      acquisition and image saving will start as soon as you press the
      'Acquire' button and will continue until 'Post Trigger' images
      have been saved.  If 'Pre Trigger' is non-zero then the
      acquisition is a little different - acquisition starts
      immediately but summed image files are not saved to disk, only
      to the computer memory.  Only the most recent 'Pre Trigger'
      images are saved in this way but acquisition will continue by
      discarding earlier images from memory.  To start saving files,
      click on the 'Trigger' button.  At this point the pre-trigger
      images will start to be saved to disk, and an additional 'Files
      After Trigger' images will be acquired and saved to disk.
    </p>

    <p>
      After each frame is captured the average value is calculated and
      displayed - this is useful to show if the readout has stabilised
      after changing exposure time or camera gain.
    </p>

    <p>
      The 'Dropped Frames' counter keeps track of how many frames were
      dropped because the computer was unable to process data
      sufficiently quickly.  Ideally, the dropped frames counter
      should stay at zero, but if you have an exceptionally slow disk,
      or try to perform too much processing - you may see the dropped
      frames count increase.  If this happens, either increase the
      exposure time, or turn off some superfluous processing option,
      or increase the amount of image memory in the "Preferences..." 
      dialog.  There is a memory usage indicator at the bottom right
      of the main window which shows the amount of available image
      memory during operations.
    </p>

    <p>
      'Dark Summed Exposures' controls the number of exposures to add
      together for the 'Dark' image.  The individual exposure time is
      controlled by the same controls used for the Acquire operation.
      The number of exposures for a dark exposure need not match that
      used during acquisition - the values will be scaled
      appropriately.
    </p>
    
    <p>
      'Output Directory' displays the path to the directory where data
      files will be saved, to change to a new directory click the
      'Select..' button and choose a new output directory.
    </p>
    
    <p>
      The 'File Pattern' and 'File Index' controls are used to specify
      the file names used to save files.  The actual file names used
      to save a file will be of the form
      "&lt;filePattern&gt;-&lt;fileIndex&gt;.tif",
      "&lt;filePattern&gt;-&lt;fileIndex&gt;.dark.tif" or
      "&lt;filePattern&gt;-&lt;fileIndex&gt;.raw.tif".  The file index
      is automatically incremented each time an image is acquired.
      QXRD will never overwrite an exisiting file - if this is
      attempted the new file will be saved with a name along the lines
      of
      "&lt;filePattern&gt;-&lt;fileIndex&gt;-&lt;duplicateIndex&gt;.tif"
      where duplicateIndex will be incremented from one until a unique
      file name results.
    </p>

    <p>
      The 'Log File' indicator displays the path name to a
      'log' file which will contain all the messages that appear in
      the 'Messages' tab, together with the results of any slices
      and/or integrations of the images.  Click 'Select...' to choose
      a different log file.  The log file format is basically the same
      format as that used by 'spec'.
    </p>
    <p>
      Click the 'More Options...' button to open the main qxrd preferences
      dialog and enter more acquisition-related options.
      <table border=0 cellpadding=5 width="100%">
        <tr>
          <td align="center">
            <img src="images/saving-preferences.png">
          </td>
        </tr>
        <tr>
          <td align="center">
            <p>
              The 'Acquire' 'More Options...' Dialog
            </p>
          </td>
        </tr>
      </table>
    </p>

    <p>
      The main extra options allow you to specify that the various kinds
      of acquired and processed data should be saved in subdirectories of
      the main output directory.  You can also control the way integrated
      data are saved, and also control whether a list of 'overflow' pixel
      positions is calculated for each acquired image.
    </p>

    <h2><a name=ImageDisplay>The Image Display</h2>
    <table border=0 cellpadding=5 width="100%">
	<tr>
	  <td>
	    <img src="images/image-panel.png">
	  </td>
	</tr>
	<tr>
	  <td>
	    <p>
	      The 'Image Display' Tab
	    </p>
	  </td>
	</tr>
    </table>


    <h2><a name=Correction>The Correction Dialog</h2>
    <table border=0 cellpadding=5 width="100%">
	<tr>
	  <td>
            <img src="images/correction-dialog.png">
	  </td>
	</tr>
	<tr>
	  <td>
	    <p>
              The 'Correction' Dialog
	    </p>
	  </td>
	</tr>
    </table>

    <p>
      The 'Correction' dialog is used to control which of the available
      automatic processing steps are performed when images are
      acquired.  Alongside each step is an estimate of how long it is
      likely to take, averaged over the last 10 or so images - you can
      use these estimates to determine if you may need to skip some
      processing steps in order to maintain the desired acquisition
      data rate.
    </p>

    <p>
      The estimated times are measured when you run an acquire
      operation and a running average value is displayed in the panel.
      Do an acquisition of 20 or so images to get decent values for
      the timings.  The timings may depend on other application
      parameters - for example the 'Oversampling Factor' strongly
      affects the integration time.  The estimated time per image
      attempts to allow for the number of CPU cores being used
      simultaneously, but may not be a very accurate estimate.
    </p>

    <p>
      Be careful which steps you choose to omit - you probably don't
      want to perform measurements where nothing is saved, so you'll
      probably want to keep at least one of the 'Save' steps.  A safe
      choice would be to choose all steps except the "Save images as
      text" step - this should give a total processing time of about
      0.5 seconds. The best choice for rapid data acquisition would be
      to save the 'raw' images and nothing else - you would then do
      the dark subtraction and integration in subsequent analysis.
    </p>

    <p>
      With a fast computer and fast disks it should be possible to
      acquire, save and integrate data at the maximum frame rate of 15
      frames/second.
    </p>

    <h2><a name=Masking>The Masking Dialog</h2>
    <table border=0 cellpadding=5 width="100%">
	<tr>
	  <td>
            <img src="images/masking-dialog.png">
	  </td>
	</tr>
	<tr>
	  <td>
	    <p>
              The 'Masking' Dialog
	    </p>
	  </td>
	</tr>
    </table>
    <p>
      The masking dialog may be used to control which pixels are used
      and which masked out in various processing steps.  The program
      implements a 'stack' of mask images - the topmost of which is used
      as a maks for processing options.  The upper panel in the masking
      dialogs represents the mask stack.  Each entry in the mask stack
      is displayed as a miniature thumbnail image - red areas are masked out.
    </p>
    <p>
      Below the mask stack display is an array of buttons that implement
      a variety of masking operations. Buttons whose label ends with dots ("...")
      will pop up a menu to let you select which stack entry to work on - other
      buttons act either on the stack as a whole, or on the top element only.
      If you hover the mouse pointer over a button you should see a description
      of its actions.
    </p>
    <p>
      Below the calculator buttons are a few controls that control the behavior
      of the two masking tools in the image window.  'Tools Unmask Pixels' controls
      whether using the masking tools causes pixels to be 'masked' (i.e. excluded
      from processing, or 'painted' red) or 'unmasked' (i.e. included in processing).
      'Mask Circles' and 'Mask Polygons' basically duplicate the behavior of clicking
      the corresponding tool in the image window.  'Circle Radius' is used to set
      the default circle radius for the circle mask tool in the image window.  If you
      click and release the circle mask tool you will mask a circle of this radius - if
      you click and drag the circle mask tool you mask a circle of a corresponding radius.
    </p>


    <h2><a name=Centering>The Centering Dialog</h2>
    <table border=0 cellpadding=5 width="100%">
	<tr>
	  <td>
            <img src="images/centering-dialog.png">
	  </td>
	</tr>
	<tr>
	  <td>
	    <p>
              The 'Centering' Dialog
	    </p>
	  </td>
	</tr>
    </table>

    <table border=0 cellpadding=5 width="100%">
	<tr>
	  <td>
	    <img src="images/center-finding.png">
	  </td>
	</tr>
	<tr>
	  <td>
	    <p>
	      Finding the center
	    </p>
	  </td>
	</tr>
    </table>

    <table border=0 cellpadding=5 width="100%">
	<tr>
	  <td>
	    <img src="images/center-found.png">
	  </td>
	</tr>
	<tr>
	  <td>
	    <p>
	      Found the center
	    </p>
	  </td>
	</tr>
    </table>
    
    <h2><a name=Integration>The Integration Dialog</h2>
    <table border=0 cellpadding=5 width="100%">
	<tr>
	  <td>
            <img src="images/integration-dialog.png">
	  </td>
	</tr>
	<tr>
	  <td>
	    <p>
              The 'Integration' Dialog
	    </p>
	  </td>
	</tr>
    </table>

    <table border=0 cellpadding=5 width="100%">
	<tr>
	  <td>
	    <img src="images/integrated-window.png">
	  </td>
	</tr>
	<tr>
	  <td>
	    <p>
	      Plot of integrated data
	    </p>
	  </td>
	</tr>
    </table>

    <h2><a name=SyncAcq>The Synchronized Acquisition Dialog</h2>
    <table border=0 cellpadding=5 width="100%">
        <tr>
          <td>
            <img src="images/sync-acquire-dialog.png">
          </td>
        </tr>
        <tr>
          <td>
            <p>
              The 'Display' Dialog
            </p>
          </td>
        </tr>
    </table>

    <h2><a name=Sync-Acq>The Slice Dialog</h2>
    <table border=0 cellpadding=5 width="100%">
        <tr>
          <td>
            <img src="images/slice-dialog.png">
          </td>
        </tr>
        <tr>
          <td>
            <p>
              The 'Slice' Dialog
            </p>
          </td>
        </tr>
    </table>

    <h2><a name=Sync-Acq>The Histogram Dialog</h2>
    <table border=0 cellpadding=5 width="100%">
        <tr>
          <td>
            <img src="images/histogram-dialog.png">
          </td>
        </tr>
        <tr>
          <td>
            <p>
              The 'Histogram' Dialog
            </p>
          </td>
        </tr>
    </table>

    <h2><a name=Sync-Acq>The Info Dialog</h2>
    <table border=0 cellpadding=5 width="100%">
        <tr>
          <td>
            <img src="images/info-dialog.png">
          </td>
        </tr>
        <tr>
          <td>
            <p>
              The 'Info' Dialog
            </p>
          </td>
        </tr>
    </table>


    <h2><a name=Sync-Acq>The Input Files Browser</h2>
    <table border=0 cellpadding=5 width="100%">
        <tr>
          <td>
            <img src="images/input-files.png">
          </td>
        </tr>
        <tr>
          <td>
            <p>
              The 'Input Files' Browser
            </p>
          </td>
        </tr>
    </table>



    <h2><a name=RemoteControl>Remote Control of QXRD</h2>
  </body>
</html>
